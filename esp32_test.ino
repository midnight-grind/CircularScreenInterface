#include <Arduino.h>
#include <ArduinoJson.h>
#include "LCD_Test.h"

UWORD Imagesize = LCD_1IN28_HEIGHT * LCD_1IN28_WIDTH * 2;
UWORD *BlackImage;
CST816S touch(6, 7, 13, 5); // sda, scl, rst, irq

bool displayFirstJson = true;
int touchCount = 0;
int toggleCount = 0; // Counter to track touches for toggling

const char* jsonData1 = "{\"interpolate\":false,\"points\":[{\"x\":51,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":51,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":51,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":51,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":54,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":55,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":56,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":57,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":58,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":46,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":47,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":48,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":49,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":50,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":51,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":52,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":53,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":54,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":55,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":56,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":58,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":59,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":60,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":61,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":62,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":63,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":63,\"y\":39,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":64,\"y\":39,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":65,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":67,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":68,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":69,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":70,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":71,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":71,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":71,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":72,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":72,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":72,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":71,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":70,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":69,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":68,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":67,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":67,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":50,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":67,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":67,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":68,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":69,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":70,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":71,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":72,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":73,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":74,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":75,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":76,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":77,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":77,\"y\":50,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":78,\"y\":50,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":78,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":79,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":92,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":91,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":90,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":89,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":88,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":88,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":88,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":89,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":89,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":90,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":91,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":50,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":91,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":90,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":90,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":89,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":88,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":86,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":86,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":85,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":106,\"y\":32,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":33,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":34,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":35,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":36,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":37,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":38,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":39,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":103,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":104,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":105,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":106,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":107,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":108,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":109,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":109,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":118,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":118,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":118,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":118,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":119,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":119,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":119,\"y\":33,\"color\":\"#ffffff\",\"strokeId\":8},{\"x\":119,\"y\":34,\"color\":\"#ffffff\",\"strokeId\":8},{\"x\":119,\"y\":35,\"color\":\"#ffffff\",\"strokeId\":8},{\"x\":119,\"y\":36,\"color\":\"#ffffff\",\"strokeId\":8},{\"x\":119,\"y\":37,\"color\":\"#ffffff\",\"strokeId\":8},{\"x\":127,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":127,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":127,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":127,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":128,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":128,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":128,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":128,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":129,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":129,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":129,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":130,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":131,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":131,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":132,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":133,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":135,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":136,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":137,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":138,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":146,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":146,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":144,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":144,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":144,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":146,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":146,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":147,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":147,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":148,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":148,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":149,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":149,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":150,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":150,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":150,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":151,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":151,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":50,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":54,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":55,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":56,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":57,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":58,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":59,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":60,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":151,\"y\":61,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":151,\"y\":62,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":150,\"y\":63,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":150,\"y\":64,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":149,\"y\":65,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":148,\"y\":66,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":147,\"y\":66,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":147,\"y\":67,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":146,\"y\":67,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":146,\"y\":68,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":69,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":143,\"y\":70,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":142,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":141,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":140,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":139,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":138,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":137,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":137,\"y\":70,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":136,\"y\":70,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":135,\"y\":69,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":135,\"y\":68,\"color\":\"#ffffff\",\"strokeId\":10}]}";

const char* jsonData2 = "{\"interpolate\":true,\"points\":[{\"x\":51,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":51,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":51,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":51,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":54,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":55,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":56,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":57,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":52,\"y\":58,\"color\":\"#ffffff\",\"strokeId\":1},{\"x\":46,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":47,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":48,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":49,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":50,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":51,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":52,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":53,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":54,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":55,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":56,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":58,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":59,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":60,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":61,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":62,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":63,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":63,\"y\":39,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":64,\"y\":39,\"color\":\"#ffffff\",\"strokeId\":2},{\"x\":65,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":67,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":68,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":69,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":70,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":71,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":71,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":71,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":72,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":72,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":72,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":71,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":70,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":69,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":68,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":67,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":67,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":50,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":66,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":67,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":67,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":68,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":69,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":70,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":71,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":72,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":73,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":74,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":75,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":76,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":77,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":77,\"y\":50,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":78,\"y\":50,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":78,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":79,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":3},{\"x\":92,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":91,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":90,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":89,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":88,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":88,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":88,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":89,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":89,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":90,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":91,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":50,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":92,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":91,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":90,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":90,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":89,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":88,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":87,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":86,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":86,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":85,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":4},{\"x\":106,\"y\":32,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":33,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":34,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":35,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":36,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":37,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":38,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":39,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":40,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":106,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":5},{\"x\":103,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":104,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":105,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":106,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":107,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":108,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":109,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":109,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":6},{\"x\":118,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":118,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":118,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":118,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":119,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":119,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":7},{\"x\":119,\"y\":33,\"color\":\"#ffffff\",\"strokeId\":8},{\"x\":119,\"y\":34,\"color\":\"#ffffff\",\"strokeId\":8},{\"x\":119,\"y\":35,\"color\":\"#ffffff\",\"strokeId\":8},{\"x\":119,\"y\":36,\"color\":\"#ffffff\",\"strokeId\":8},{\"x\":119,\"y\":37,\"color\":\"#ffffff\",\"strokeId\":8},{\"x\":127,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":127,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":127,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":127,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":128,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":128,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":128,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":128,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":129,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":129,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":129,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":130,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":131,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":131,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":132,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":133,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":134,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":135,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":136,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":137,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":138,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":9},{\"x\":146,\"y\":41,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":146,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":42,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":43,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":144,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":144,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":144,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":146,\"y\":47,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":146,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":147,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":147,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":148,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":148,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":149,\"y\":44,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":149,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":150,\"y\":45,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":150,\"y\":46,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":150,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":151,\"y\":48,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":151,\"y\":49,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":50,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":51,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":52,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":53,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":54,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":55,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":56,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":57,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":58,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":59,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":152,\"y\":60,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":151,\"y\":61,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":151,\"y\":62,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":150,\"y\":63,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":150,\"y\":64,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":149,\"y\":65,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":148,\"y\":66,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":147,\"y\":66,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":147,\"y\":67,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":146,\"y\":67,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":146,\"y\":68,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":145,\"y\":69,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":143,\"y\":70,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":142,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":141,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":140,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":139,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":138,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":137,\"y\":71,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":137,\"y\":70,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":136,\"y\":70,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":135,\"y\":69,\"color\":\"#ffffff\",\"strokeId\":10},{\"x\":135,\"y\":68,\"color\":\"#ffffff\",\"strokeId\":10}]}";

void setup() {
    Serial.begin(115200);
    touch.begin();
    // PSRAM Initialize
    if (psramInit()) {
        Serial.println("\nPSRAM is correctly initialized");
    } else {
        Serial.println("PSRAM not available");
    }
    if ((BlackImage = (UWORD *)ps_malloc(Imagesize)) == NULL) {
        Serial.println("Failed to apply for black memory...");
        exit(0);
    }

    // Initialize GPIO and display
    if (DEV_Module_Init() != 0)
        Serial.println("GPIO Init Fail!");
    else
        Serial.println("GPIO Init successful!");

    LCD_1IN28_Init(HORIZONTAL);
    LCD_1IN28_Clear(BLACK);

    // Create a new image cache named IMAGE_RGB and fill it with black
    Paint_NewImage((UBYTE *)BlackImage, LCD_1IN28.WIDTH, LCD_1IN28.HEIGHT, 0, BLACK);
    Paint_SetScale(65);
    Paint_SetRotate(ROTATE_0);
    Paint_Clear(BLACK);

    // Initial display
    displayJsonData();
}

void drawOnScreen() {
    // Handle screen touches and toggle between two JSON data sets
    if (touch.available()) {
        touchCount++;
        toggleCount++;
        Serial.print("Touch detected! Count: ");
        Serial.println(touchCount);

        if (toggleCount >= 2) { // Toggle after every second touch
            displayFirstJson = !displayFirstJson;
            displayJsonData();
            toggleCount = 0; // Reset toggle count
        }

        delay(50); // Debounce delay
    }
}

// Helper function to convert hex color string (e.g., "#RRGGBB") to RGB565 format
uint16_t parseHexColor(const char* hexColor) {
    uint8_t r = strtol(hexColor + 1, NULL, 16) >> 16;
    uint8_t g = strtol(hexColor + 3, NULL, 16) >> 8;
    uint8_t b = strtol(hexColor + 5, NULL, 16);

    // Convert RGB888 to RGB565
    return ((r & 0xF8) << 8) | ((g & 0xFC) << 3) | (b >> 3);
}

// Linear interpolation function between two points
int lerp(int start, int end, float t) {
    return start + t * (end - start);
}

void interpolateAndDraw(int x0, int y0, int x1, int y1, uint16_t color) {
    int dx = abs(x1 - x0);
    int dy = abs(y1 - y0);
    int steps = max(dx, dy);
    float increment = 1.0 / steps;

    for (int i = 0; i <= steps; i++) {
        float t = i * increment;
        int x = lerp(x0, x1, t);
        int y = lerp(y0, y1, t);
        Paint_DrawPoint(x, y, color, DOT_PIXEL_1X1, DOT_STYLE_DFT);
    }
}

void displayJsonData() {
    StaticJsonDocument<8000> doc;  // Increase size if necessary
    const char* jsonData = displayFirstJson ? jsonData1 : jsonData2;

    DeserializationError error = deserializeJson(doc, jsonData);

    if (error) {
        Serial.print("Failed to parse JSON: ");
        Serial.println(error.c_str());
        return;
    }

    bool interpolate = doc["interpolate"];
    JsonArray points = doc["points"];

    Paint_Clear(BLACK); // Clear the display before drawing new content

    int prevX = -1;
    int prevY = -1;
    const char* prevColorStr = "";

    for (JsonObject point : points) {
        int x = point["x"];
        int y = point["y"];
        const char* colorStr = point["color"];

        // Convert the color string to an RGB565 format
        uint16_t color = parseHexColor(colorStr);

        // If this is not the first point and interpolation is enabled, interpolate from the previous point
        if (interpolate && prevX != -1 && prevY != -1 && strcmp(prevColorStr, colorStr) == 0) {
            interpolateAndDraw(prevX, prevY, x, y, color);
        }

        // Update previous point
        prevX = x;
        prevY = y;
        prevColorStr = colorStr;

        // Draw the current point
        Paint_DrawPoint(x, y, color, DOT_PIXEL_1X1, DOT_STYLE_DFT);
    }

    // Refresh the display
    LCD_1IN28_Display(BlackImage);
}

void loop() {
    drawOnScreen();
}
